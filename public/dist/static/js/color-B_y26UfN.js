import"./vue-CtDVafEO.js";import{E as it}from"./ElfAutocomplete-CrSnxusc.js";import{o as ut,t as dt}from"./@vueuse.core-CohTIrf7.js";import{d as He,e as _e,a as j,o as H,k as w,b as z,F as de,as as me,f as Oe,w as mt,au as U,l as ue,m as a,c as l,Y as p}from"./@vue.runtime-core-KVqrk7Le.js";import{r as M,a as ct,u as Ae}from"./@vue.reactivity-Bi9M0yVH.js";import{w as re}from"./@vue.runtime-dom-C_oXYm3W.js";import{n as le,a as Se,a2 as X}from"./@vue.shared-Dggo55H6.js";import{_ as Ne}from"./index-pdh1cF61.js";import{d as pt}from"./vue-router-DIUm41vP.js";import"./vue-echarts-CBpFAVX6.js";import{b as g,a2 as qe}from"./element-plus-8GMMjX5x.js";import"./store-Dk_9dvJf.js";import{u as ft}from"./index-BccKIUN1.js";import{f as vt}from"./@tauri-apps.plugin-http-Cv3_YKMT.js";import"./@ctrl.tinycolor-DIJrhXRL.js";import"./jian-pinyin-BQnIJfAD.js";import"./@vueuse.shared-BT9VTltu.js";import"./@tauri-apps.api-D6pxdox3.js";import"./@element-plus.icons-vue-Bg3IdkJH.js";import"./@tauri-apps.plugin-window-state-CKcvB-Yq.js";import"./@tauri-apps.plugin-os-DAwCXN2F.js";import"./monaco-editor-B5RCHlt7.js";import"./axios-BtGIl_yX.js";import"./nprogress-BeKHEGZT.js";import"./lodash-es-h_VBaftc.js";import"./pinia-T0akb6C6.js";import"./vue-demi-CDM4a8Cx.js";import"./@vue.devtools-api-Cow_pXkh.js";import"./mockjs-go_XKZqM.js";import"./merge-BYMyyMN3.js";import"./array.prototype.flat-CqsTEBEB.js";import"./define-properties-DeBWC5Rj.js";import"./object-keys-ZG7jWpak.js";import"./define-data-property-XI3tayz4.js";import"./es-define-property-bDCdrV83.js";import"./es-errors-CjWgD-AT.js";import"./gopd-fcd2-aIC.js";import"./has-property-descriptors-DfOn7RT1.js";import"./call-bind-D1i_0m5p.js";import"./set-function-length-COsh-RyW.js";import"./get-intrinsic-CHv0DtqP.js";import"./es-object-atoms-xlU4QJdQ.js";import"./math-intrinsics-BVu9SHZv.js";import"./has-symbols-CySAGvJ4.js";import"./get-proto-BgUIOQjL.js";import"./dunder-proto-DSNbQepv.js";import"./call-bind-apply-helpers-CpQE9enO.js";import"./function-bind-BbkWVFrm.js";import"./hasown-C2NEVhna.js";import"./es-abstract-DUkx-dit.js";import"./set-proto-BDccI1tp.js";import"./call-bound-DaX5B1jO.js";import"./is-callable-BYFz_UGF.js";import"./object-inspect-CXH1Dwru.js";import"./es-to-primitive-nD9bwwaO.js";import"./is-date-object-hIdu1A6N.js";import"./has-tostringtag-DZp5EflQ.js";import"./is-symbol-ysoNMWlI.js";import"./safe-regex-test-dHpqQmqk.js";import"./is-regex-DNZt5_iq.js";import"./string.prototype.trim-BkN8AABq.js";import"./es-shim-unscopables-BUmCp8XM.js";import"./mitt-DJ65BbbF.js";import"./clone-deep-BBv7p2lF.js";import"./shallow-clone-BEhzUZN4.js";import"./kind-of-l3izQsJJ.js";import"./is-plain-object-CoKbMfKO.js";import"./isobject-BqYMxyhm.js";import"./ant-design-vue-XGpV5x1K.js";import"./@babel.runtime-Bq4_u9L9.js";import"./@ant-design.colors-D6xsUwZE.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./@emotion.hash-WldOFDRm.js";import"./@emotion.unitless-sScrWPmR.js";import"./stylis-D5iaQeiq.js";import"./scroll-into-view-if-needed-SxpMpKWN.js";import"./compute-scroll-into-view-1gs_hJI2.js";import"./vue-types-DyXJsc1R.js";import"./dom-align-CRCehRfe.js";import"./@ant-design.icons-vue-BqBMHCUT.js";import"./@ant-design.icons-svg-C3D1I238.js";import"./dayjs-ojb8-92M.js";import"./async-validator-w7BS6a8H.js";import"./throttle-debounce-CUWDS_la.js";import"./element-plus-x-Cm2l4aHC.js";import"./@vueuse.integrations-rctT4Y8t.js";import"./sortablejs-DK6jXh7t.js";import"./qrcode-COaswOGQ.js";import"./dijkstrajs-D_NXgYpA.js";import"./@tiptap.vue-3-5ppH0fxe.js";import"./@tiptap.core-HsqG-hEX.js";import"./prosemirror-state-DcLGimL2.js";import"./prosemirror-model-CRZLy2j9.js";import"./orderedmap-C4TimWWB.js";import"./prosemirror-transform-C09io-ca.js";import"./prosemirror-view-DEGNo2BM.js";import"./prosemirror-keymap-dTE5U1JE.js";import"./w3c-keyname-DEtA-KhA.js";import"./prosemirror-commands-Cj2EY2xy.js";import"./prosemirror-schema-list-cRCmABXK.js";import"./@tiptap.starter-kit-Dc4urPX6.js";import"./@tiptap.extension-blockquote-C36XX1xc.js";import"./@tiptap.extension-bold-Dpl3-oWi.js";import"./@tiptap.extension-bullet-list-CcyZOG3C.js";import"./@tiptap.extension-code-DOXQzMo1.js";import"./@tiptap.extension-code-block-5ZZ8mYzi.js";import"./@tiptap.extension-document-D_ZJDK3z.js";import"./@tiptap.extension-dropcursor-BiiRwYxD.js";import"./prosemirror-dropcursor-BCbxwt2k.js";import"./@tiptap.extension-gapcursor-DZyaxBnV.js";import"./prosemirror-gapcursor-CCa3-K6O.js";import"./@tiptap.extension-hard-break-CNGLpIH1.js";import"./@tiptap.extension-heading-BP9ELht2.js";import"./@tiptap.extension-history-C3QvnNgs.js";import"./prosemirror-history-ezVJ39cF.js";import"./rope-sequence-Cxv9J64N.js";import"./@tiptap.extension-horizontal-rule-CPJM0s0j.js";import"./@tiptap.extension-italic-Buz_PjJW.js";import"./@tiptap.extension-list-item-8NlRO8Zx.js";import"./@tiptap.extension-ordered-list-CLbpeiEw.js";import"./@tiptap.extension-paragraph-D0lZeD6Q.js";import"./@tiptap.extension-strike-DTJejtf9.js";import"./@tiptap.extension-text-tSZYoMpa.js";import"./@tiptap.extension-mention-DNDOCq49.js";import"./@tiptap.suggestion-D1eFLxRa.js";import"./@tiptap.extension-placeholder-DBGfcfEl.js";import"./@tiptap.extension-character-count-Dk6cioUx.js";import"./@tiptap.extension-underline-7zf0dUeQ.js";import"./@tiptap.extension-image-B59mcFtS.js";import"./@tiptap.extension-text-align-CIbvwxhJ.js";import"./@tiptap.extension-link-B9Mu_PH9.js";import"./linkifyjs-DVrXeg1a.js";import"./@tiptap.extension-text-style-T6uw5ms4.js";import"./@vue.compiler-dom-cNnnWTtA.js";import"./@vue.compiler-core-BT_4uvnR.js";import"./vue-reveal-effect-Bq7joTW1.js";import"./vue-web-terminal-kEr71b--.js";import"./@popperjs.core-BXtLZkxx.js";import"./memoize-one-CoxqdkY2.js";import"./normalize-wheel-es-C7wPC_vT.js";import"./@floating-ui.dom-DmCU76BS.js";import"./@floating-ui.core-DRpLWvtu.js";import"./@floating-ui.utils-CUfO2VY0.js";import"./echarts-E_mfcNLb.js";import"./tslib-Cg4x8ZAA.js";import"./zrender-BgSSqBUn.js";const gt=["title"],bt={class:"panelHeader"},ht={class:"panelBody"},wt={class:"colorList themeColors"},yt=["onMouseover","onClick","title"],xt={class:"gradientColorWrapper"},_t=["onMouseover","onClick","title"],Ct={class:"colorList standardColors"},kt=["onMouseover","onClick","title"],Mt=["value"],Vt={name:"ColorPicker"},zt=He({...Vt,props:{modelValue:{type:String,required:!0},defaultColor:{type:String,required:!1,default:"#000000"},disabled:{type:Boolean,required:!1,default:!1}},emits:["update:modelValue","change"],setup(Te,{emit:ce}){const B=Te,se=ce,J=M(!1),pe=M(null),E=M(null),W=M(""),Q=M(B.modelValue),P=()=>{B.disabled||(J.value=!0)},fe=()=>{J.value=!1};ut(pe,fe);const oe=v=>{W.value=v},ae=()=>{W.value=""},K=v=>{se("update:modelValue",v),se("change",v),fe()},Ce=()=>{K(B.defaultColor)},ke=()=>{E.value&&(E.value.click(),E.value.value=B.modelValue||B.defaultColor)},Me=v=>{const _=v.target;Q.value=_.value,K(_.value)},Ve=["#000000","#ffffff","#eeece1","#1e497b","#4e81bb","#e2534d","#9aba60","#8165a0","#47acc5","#f9974c"],Ie=[["#7f7f7f","#f2f2f2"],["#0d0d0d","#808080"],["#1c1a10","#ddd8c3"],["#0e243d","#c6d9f0"],["#233f5e","#dae5f0"],["#632623","#f2dbdb"],["#4d602c","#eaf1de"],["#3f3150","#e6e0ec"],["#1e5867","#d9eef3"],["#99490f","#fee9da"]],R=["#c21401","#ff1e02","#ffc12a","#ffff3a","#90cf5b","#00af57","#00afee","#0071be","#00215f","#72349d"],V=_e(()=>B.modelValue||B.defaultColor),b=_e(()=>W.value||V.value),ve=_e(()=>Ie.map(([v,_])=>O(v,_,5))),Z=v=>v.length===4?`#${v[1]}${v[1]}${v[2]}${v[2]}${v[3]}${v[3]}`:v,A=(v,_,y)=>`#${(v<<16|_<<8|y).toString(16).padStart(6,"0")}`,T=v=>{const _=Z(v),y=[];for(let C=1;C<7;C+=2)y.push(parseInt(`0x${_.slice(C,C+2)}`,16));return y},O=(v,_,y)=>{const C=T(v),x=T(_),q=(x[0]-C[0])/y,ne=(x[1]-C[1])/y,ze=(x[2]-C[2])/y,Y=[];for(let ee=0;ee<y;ee++){const $e=Math.round(q*ee+C[0]),S=Math.round(ne*ee+C[1]),Re=Math.round(ze*ee+C[2]);Y.push(A($e,S,Re))}return Y};return(v,_)=>(H(),j("div",{class:Se(["m-colorPicker",{disabled:B.disabled}]),ref_key:"colorPickerRef",ref:pe},[w(" 颜色显示按钮 "),z("div",{class:"colorBtn",style:le({backgroundColor:V.value}),onClick:re(P,["stop"]),title:V.value},null,12,gt),w(" 颜色面板 "),z("div",{class:Se(["colorPanel",{open:J.value}])},[w(" 面板头部 "),z("div",bt,[z("div",{class:"colorPreview",style:le({backgroundColor:b.value})},null,4),z("div",{class:"defaultColorBtn",onClick:re(Ce,["stop"]),onMouseover:_[0]||(_[0]=y=>oe(B.defaultColor)),onMouseout:ae}," 默认颜色 ",32)]),w(" 面板主体 "),z("div",ht,[w(" 主题颜色 "),_[1]||(_[1]=z("h3",{class:"colorTitle"},"主题颜色",-1)),z("ul",wt,[(H(),j(de,null,me(Ve,(y,C)=>z("li",{key:`theme-${C}`,style:le({backgroundColor:y}),onMouseover:x=>oe(y),onMouseout:ae,onClick:re(x=>K(y),["stop"]),title:y},null,44,yt)),64))]),w(" 渐变颜色面板 "),_[2]||(_[2]=z("h3",{class:"colorTitle"},"渐变颜色",-1)),z("div",xt,[(H(!0),j(de,null,me(ve.value,(y,C)=>(H(),j("div",{key:`gradient-group-${C}`,class:"gradientColorGroup"},[(H(!0),j(de,null,me(y,(x,q)=>(H(),j("span",{key:`gradient-${C}-${q}`,class:"gradientColorItem",style:le({backgroundColor:x}),onMouseover:ne=>oe(x),onMouseout:ae,onClick:re(ne=>K(x),["stop"]),title:x},null,44,_t))),128))]))),128))]),w(" 标准颜色 "),_[3]||(_[3]=z("h3",{class:"colorTitle"},"标准颜色",-1)),z("ul",Ct,[(H(),j(de,null,me(R,(y,C)=>z("li",{key:`standard-${C}`,style:le({backgroundColor:y}),onMouseover:x=>oe(y),onMouseout:ae,onClick:re(x=>K(y),["stop"]),title:y},null,44,kt)),64))]),w(" 更多颜色（原生取色器） "),z("h3",{class:"colorTitle moreColorBtn",onClick:re(ke,["stop"]),title:"点击选择更多颜色"}," 更多颜色... "),z("input",{type:"color",ref_key:"html5ColorEl",ref:E,value:Q.value,onChange:Me,class:"nativeColorInput"},null,40,Mt)])],2)],2))}}),$t=Ne(zt,[["__scopeId","data-v-6faa92d8"],["__file","/home/runner/work/seer-micro/seer-micro/frontend/src/modules/editor/components/ColorPicker.vue"]]),Rt=["onClick"],Ut=He({name:"undefined"}),Bt=He({...Ut,setup(Te){M("");const{service:ce}=ft(),B=pt(),se=M([]),J=M();Oe(()=>{ce.game.shiny.info({id:B.query.id}).then(o=>{se.value=JSON.parse(o.bind_elf_ids),J.value=JSON.parse(o.color),rt(JSON.parse(o.color).matrix)})});const pe=()=>{ce.game.shiny.update({id:B.query.id,color:J.value}).then(o=>{g.success("保存成功")})},E=(o,e,r)=>{const i=u=>("0"+u.toString(16)).slice(-2);return"#"+i(o)+i(e)+i(r)},W=o=>({r:parseInt(o.slice(1,3),16),g:parseInt(o.slice(3,5),16),b:parseInt(o.slice(5,7),16)}),Q=()=>[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],P=(o,e)=>{const r=[...o,0,0,0,0,1],i=[...e,0,0,0,0,1],u=new Array(25).fill(0);for(let t=0;t<5;t++)for(let n=0;n<5;n++){let m=0;for(let d=0;d<5;d++)m+=r[t*5+d]*i[d*5+n];u[t*5+n]=m}return u.slice(0,20)},fe=o=>[1,0,0,0,o,0,1,0,0,o,0,0,1,0,o,0,0,0,1,0],oe=o=>{const e=1+o/100,r=128*(1-e);return[e,0,0,0,r,0,e,0,0,r,0,0,e,0,r,0,0,0,1,0]},ae=o=>{const e=1+o/100,r=.2126,i=.7152,u=.0722,t=(1-e)*r+e,n=(1-e)*r,m=(1-e)*r,d=(1-e)*i,c=(1-e)*i+e,f=(1-e)*i,h=(1-e)*u,k=(1-e)*u,I=(1-e)*u+e;return[t,n,m,0,0,d,c,f,0,0,h,k,I,0,0,0,0,0,1,0]},K=o=>{const e=o*Math.PI/180,r=Math.cos(e),i=Math.sin(e),u=.2126,t=.7152,n=.0722;return[u+(1-u)*r-u*i,t-t*r-t*i,n-n*r+(1-n)*i,0,0,u-u*r+.143*i,t+(1-t)*r+.14*i,n-n*r-.283*i,0,0,u-u*r-(1-u)*i,t-t*r+t*i,n+(1-n)*r+n*i,0,0,0,0,0,1,0]},Ce=o=>{const e=1-2*o,r=255*o;return[e,0,0,0,r,0,e,0,0,r,0,0,e,0,r,0,0,0,1,0]},ke=o=>[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,o,0],Me=(o,e,r,i)=>{if(o.length===0)return null;const u=o.length,t=Array.from({length:r},()=>new Array(r).fill(0)),n=new Array(r).fill(0);for(let m=0;m<u;m++){const d=o[m];for(let c=0;c<r;c++){n[c]+=d[c]*e[m];for(let f=0;f<r;f++)t[c][f]+=d[c]*d[f]}}for(let m=0;m<r;m++)t[m][m]+=i;return Ve(t,n)},Ve=(o,e)=>{const r=o.length,i=o.map((t,n)=>t.concat([e[n]]));for(let t=0;t<r;t++){let n=t;for(let d=t+1;d<r;d++)Math.abs(i[d][t])>Math.abs(i[n][t])&&(n=d);if(Math.abs(i[n][t])<1e-10)return null;if(n!==t){const d=i[t];i[t]=i[n],i[n]=d}const m=i[t][t];for(let d=t;d<=r;d++)i[t][d]/=m;for(let d=0;d<r;d++){if(d===t)continue;const c=i[d][t];for(let f=t;f<=r;f++)i[d][f]-=c*i[t][f]}}const u=new Array(r);for(let t=0;t<r;t++)u[t]=i[t][r];return u},{copy:Ie}=dt(),R=M(null),V=M(null),b=M(Q());mt(b,(o,e)=>{J.value.matrix=o});const ve=M(null),Z=M(!0),A=M([]),T=M(null),O=M("准备就绪。载入图片后开始取样。"),v=M(!0),_=M(!0),y=M(.001),C=M("#ffffff"),x=ct({brightness:0,contrast:0,saturation:0,hue:0,invert:0,alpha:1}),q=M(""),ne=_e(()=>["R'","G'","B'","A'"].map((e,r)=>{const i=r*5;return{label:e,index:r,r:Y(b.value[i]),g:Y(b.value[i+1]),b:Y(b.value[i+2]),a:Y(b.value[i+3]),offset:Y(b.value[i+4])}})),ze=()=>window.isTauri,Y=o=>Math.abs(o)<1e-9?0:o.toFixed(3).replace(/\.000$/,"");Oe(()=>{R.value&&(R.value.ctx=R.value.getContext("2d")),V.value&&(V.value.ctx=V.value.getContext("2d"))});const ee=o=>{const e=o.raw;if(!e)return;const r=new Image;r.onload=()=>{ve.value=r;const i=800,u=600;let t=r.naturalWidth,n=r.naturalHeight;const m=Math.min(i/t,u/n,1);t=Math.round(t*m),n=Math.round(n*m),R.value.width=t,R.value.height=n,V.value.width=t,V.value.height=n,R.value.ctx.drawImage(r,0,0,t,n),S(),g.success("图片加载成功！")},r.src=URL.createObjectURL(e)},$e=async o=>{try{const e=`http://seerh5.61.com/resource/assets/fightResource/pet/${o.id}.png`;g.info(`正在加载 ${o.name} 图片...`);const i=await(await vt(e,{method:"GET"})).blob(),u=URL.createObjectURL(i),t=new Image;t.onload=()=>{URL.revokeObjectURL(u),ve.value=t;const n=800,m=600;let d=t.naturalWidth,c=t.naturalHeight;const f=Math.min(n/d,m/c,1);d=Math.round(d*f),c=Math.round(c*f),R.value.width=d,R.value.height=c,V.value.width=d,V.value.height=c,R.value.ctx.drawImage(t,0,0,d,c),S(),g.success(`${o.name} 图片加载成功！`)},t.onerror=()=>{URL.revokeObjectURL(u),g.error(`${o.name} 图片解析失败，可能是格式错误！`)},t.src=u}catch(e){g.error(`${o.name} 本体图加载失败！${e.message||"网络错误"}`)}},S=()=>{var d;if(!((d=R.value)!=null&&d.width))return;const o=R.value.width,e=R.value.height,r=R.value.ctx.getImageData(0,0,o,e),i=V.value.ctx.createImageData(o,e),u=b.value,t=r.data,n=i.data,m=t.length;for(let c=0;c<m;c+=4){const f=t[c],h=t[c+1],k=t[c+2],I=t[c+3],G=u[0]*f+u[1]*h+u[2]*k+u[3]*I+u[4],L=u[5]*f+u[6]*h+u[7]*k+u[8]*I+u[9],N=u[10]*f+u[11]*h+u[12]*k+u[13]*I+u[14],D=u[15]*f+u[16]*h+u[17]*k+u[18]*I+u[19];n[c]=Math.max(0,Math.min(255,Math.round(G))),n[c+1]=Math.max(0,Math.min(255,Math.round(L))),n[c+2]=Math.max(0,Math.min(255,Math.round(N))),n[c+3]=Math.max(0,Math.min(255,Math.round(D)))}V.value.ctx.putImageData(i,0,0),Re(),O.value=`已应用矩阵。样本数：${A.value.length}`,g.info("矩阵应用成功！")},Re=()=>{A.value.forEach(o=>{const e=V.value.ctx.getImageData(o.x,o.y,1,1).data;o.dst=[e[0],e[1],e[2],e[3]]})},je=o=>{var Ee;const e=R.value;if(!e||!e.width||!e.height)return;const r=e.getBoundingClientRect(),i=window.devicePixelRatio||1,u=e.width,t=e.height,n=r.width,m=r.height,d=o.clientX-r.left-window.scrollX,c=o.clientY-r.top-window.scrollY,f=u/n,h=t/m;let k=d*f*i,I=c*h*i;k=Math.max(0,Math.min(Math.round(k),u-1)),I=Math.max(0,Math.min(Math.round(I),t-1));const G=e.getContext("2d"),L=(Ee=V.value)==null?void 0:Ee.getContext("2d");if(!G||!L)return;const D=Math.floor(3/2);let ge=0,s=0,$=0,te=0,De=0,Ge=0,Pe=0,Le=0,F=0;for(let Ue=-D;Ue<=D;Ue++)for(let Be=-D;Be<=D;Be++){const he=k+Ue,we=I+Be;if(he<0||he>=u||we<0||we>=t)continue;const ye=G.getImageData(he,we,1,1).data,xe=L.getImageData(he,we,1,1).data;ge+=ye[0],s+=ye[1],$+=ye[2],te+=ye[3],De+=xe[0],Ge+=xe[1],Pe+=xe[2],Le+=xe[3],F++}F=F||1;const be=[Math.round(ge/F),Math.round(s/F),Math.round($/F),Math.round(te/F)],nt=[Math.round(De/F),Math.round(Ge/F),Math.round(Pe/F),Math.round(Le/F)],Fe=`${Date.now()}-${Math.random().toString(16).slice(2,10)}`;A.value.push({id:Fe,x:Math.round(k/i),y:Math.round(I/i),src:be,dst:nt,targetHex:E(be[0],be[1],be[2]),weight:1}),T.value=Fe,O.value="添加样本成功。提示：想要“非只改偏移”的结果，请覆盖<b>明暗/冷暖/纯度</b>都不同的点，建议 ≥ 5 个。",g.success("样本添加成功！")},We=o=>{if(!T.value){g.warning("请先选中一个样本！");return}const e=V.value.getBoundingClientRect(),r=Math.floor((o.clientX-e.left)*(V.value.width/e.width)),i=Math.floor((o.clientY-e.top)*(V.value.height/e.height)),u=V.value.ctx.getImageData(r,i,1,1).data,t=E(u[0],u[1],u[2]),n=A.value.findIndex(m=>m.id===T.value);n>=0&&(A.value[n].targetHex=t,O.value=`样本 #${n+1} 目标色更新为 ${t}`,g.success(`样本 #${n+1} 目标色已更新！`))},Ye=o=>{const e=W(o.targetHex),r=e.r-o.src[0],i=e.g-o.src[1],u=e.b-o.src[2],t=[1,0,0,0,r,0,1,0,0,i,0,0,1,0,u,0,0,0,1,0];Z.value?b.value=t:b.value=P(t,b.value),S(),g.success("偏移匹配成功！")},Xe=o=>{qe.confirm("确定要删除该样本吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{A.value=A.value.filter(e=>e.id!==o),T.value===o&&(T.value=null),g.success("样本删除成功！")})},Je=()=>{if(A.value.length===0){g.warning("请先添加样本并设置目标色！");return}const o=parseFloat(y.value||"0");let e=null;if(_){const r=[],i=[];let u=0;A.value.forEach(n=>{const m=Math.max(0,n.weight||0);if(m<=0)return;const d=[n.src[0],n.src[1],n.src[2],n.src[3],1],c=W(n.targetHex),f=new Array(15).fill(0);f[0]=d[0]*m,f[1]=d[1]*m,f[2]=d[2]*m,f[3]=d[3]*m,f[4]=d[4]*m;const h=new Array(15).fill(0);h[5]=d[0]*m,h[6]=d[1]*m,h[7]=d[2]*m,h[8]=d[3]*m,h[9]=d[4]*m;const k=new Array(15).fill(0);k[10]=d[0]*m,k[11]=d[1]*m,k[12]=d[2]*m,k[13]=d[3]*m,k[14]=d[4]*m,r.push(f,h,k),i.push(c.r*m,c.g*m,c.b*m),u++}),u<2&&(O.value='<span style="color: #e6a23c">样本太少，建议≥5个、且颜色要有差异。</span>');const t=Me(r,i,15,o);if(!t){g.error("拟合失败：矩阵病态或数值奇异。试增大 λ、增加样本或提升多样性。");return}e=[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],...v.value?[0,0,0,1,0]:b.value.slice(15,20)],O.value=`<span style="color: #67c23a">已拟合全参数</span>（λ=${o}）。若效果像“只动偏移列”，请增加多样化样本（不同明度/色相/饱和度）。`}else{let r=0,i=0,u=0,t=0;if(A.value.forEach(c=>{const f=Math.max(0,c.weight||0);if(f<=0)return;const h=W(c.targetHex);r+=(h.r-c.src[0])*f,i+=(h.g-c.src[1])*f,u+=(h.b-c.src[2])*f,t+=f}),t<=0){g.warning("有效权重为 0！");return}const n=r/t,m=i/t,d=u/t;e=[1,0,0,0,n,0,1,0,0,m,0,0,1,0,d,...v.value?[0,0,0,1,0]:b.value.slice(15,20)],O.value=`<span style="color: #67c23a">已拟合偏移列</span>：ΔR=${n.toFixed(2)}, ΔG=${m.toFixed(2)}, ΔB=${d.toFixed(2)}。`}b.value=e,S(),g.success("矩阵拟合成功！")},Qe=()=>{if(!T.value){g.warning("请先选中一条样本！");return}const o=A.value.find(n=>n.id===T.value);if(!o){g.error("未找到样本！");return}const e=W(C.value),r=e.r-o.src[0],i=e.g-o.src[1],u=e.b-o.src[2],t=[1,0,0,0,r,0,1,0,0,i,0,0,1,0,u,0,0,0,1,0];Z.value?b.value=t:b.value=P(t,b.value),S(),g.success("快捷偏移匹配成功！")},Ke=()=>{let o=Q();const{brightness:e,contrast:r,saturation:i,hue:u,invert:t,alpha:n}=x;o=P(K(u),o),o=P(ae(i),o),o=P(oe(r),o),o=P(fe(e),o),t!==0&&(o=P(Ce(t),o)),n!==1&&(o=P(ke(n),o)),Z.value?b.value=o:b.value=P(o,b.value),S(),g.success("滑杆矩阵生成成功！")},Ze=()=>{b.value=Q(),S(),g.success("矩阵已重置为单位矩阵！")},et=()=>{b.value=Q(),S(),g.success("矩阵已设为单位矩阵！")},ie=(o,e,r)=>{const i=o*5+e;b.value[i]=parseFloat(r||"0")},tt=()=>{S(),g.success("矩阵输入值已应用！")},lt=()=>{const o=b.value.map(e=>Math.abs(e)<1e-9?0:+e.toFixed(6));q.value=o.map((e,r)=>r%5===4?e+(r===19?"":`,
`):e+",").join(" "),g.success("矩阵已导出到文本区！")},ot=()=>{q.value="",g.info("文本区已清空！")},at=()=>{const e=(q.value.match(/[-+]?\d*\.?\d+(?:e[-+]?\d+)?/gi)||[]).slice(0,20).map(parseFloat);if(e.length<20){g.warning("未解析到 20 个数字！");return}b.value=e,S(),g.success("矩阵已从文本区加载！")},rt=o=>{if(o.length<20){g.warning("未解析到 20 个数字！");return}b.value=o,S()},st=()=>{qe.confirm("确定要清空所有样本吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{A.value=[],T.value=null,g.success("样本已清空！")})};return(o,e)=>{const r=U("el-text"),i=U("el-button"),u=U("el-upload"),t=U("el-row"),n=U("el-col"),m=U("el-divider"),d=U("el-input-number"),c=U("el-scrollbar"),f=U("el-color-picker"),h=U("el-card"),k=U("el-checkbox"),I=U("el-switch"),G=U("el-form-item"),L=U("el-slider"),N=U("el-table-column"),D=U("el-input"),ge=U("el-table");return H(),ue(t,{gutter:0},{default:a(()=>[w(" 左侧面板：仅图片+选色核心功能 "),l(n,{span:7},{default:a(()=>[l(h,{class:"card",shadow:"hover","body-style":"height: 100%;"},{header:a(()=>[l(r,{type:"primary"},{default:a(()=>[...e[14]||(e[14]=[p("1) 图片载入 & 选色",-1)])]),_:1}),ze()?(H(),ue(it,{key:0,modelValue:o.searchText,"onUpdate:modelValue":e[0]||(e[0]=s=>o.searchText=s),imageMode:"sprite","whitelist-elf-ids":se.value,onSelect:$e},null,8,["modelValue","whitelist-elf-ids"])):w("v-if",!0)]),default:a(()=>[l(t,{gutter:10,class:"mb-3"},{default:a(()=>[l(u,{"auto-upload":!1,"on-change":ee,accept:"image/*",class:"upload-demo"},{default:a(()=>[Ae(B).query.id?w("v-if",!0):(H(),ue(i,{key:0,type:"primary",size:"small"},{default:a(()=>[...e[15]||(e[15]=[p("选择图片",-1)])]),_:1}))]),_:1}),Ae(B).query.id?(H(),ue(i,{key:0,onClick:e[1]||(e[1]=s=>pe()),type:"primary",size:"small"},{default:a(()=>[...e[16]||(e[16]=[p("保存",-1)])]),_:1})):w("v-if",!0),l(i,{onClick:Ze,size:"small"},{default:a(()=>[...e[17]||(e[17]=[p("重置矩阵",-1)])]),_:1}),l(i,{onClick:S,size:"small",type:"success"},{default:a(()=>[...e[18]||(e[18]=[p("应用矩阵",-1)])]),_:1})]),_:1}),l(t,{gutter:10,class:"preview-row mb-3"},{default:a(()=>[l(n,{span:12},{default:a(()=>[l(t,{justify:"space-between",align:"bottom",class:"mb-1"},{default:a(()=>[l(r,{size:"small",type:"secondary"},{default:a(()=>[...e[19]||(e[19]=[p("原图",-1)])]),_:1}),l(r,{size:"small",type:"info"},{default:a(()=>[...e[20]||(e[20]=[p("点击加样本",-1)])]),_:1})]),_:1}),z("canvas",{ref_key:"canvasSrc",ref:R,width:"400",height:"300",title:"点击以添加样本",onClick:je,class:"canvas"},null,512)]),_:1}),l(n,{span:12},{default:a(()=>[l(t,{justify:"space-between",align:"bottom",class:"mb-1"},{default:a(()=>[l(r,{size:"small",type:"secondary"},{default:a(()=>[...e[21]||(e[21]=[p("效果预览",-1)])]),_:1}),l(r,{size:"small",type:"info"},{default:a(()=>[...e[22]||(e[22]=[p("点击设目标色",-1)])]),_:1})]),_:1}),z("canvas",{ref_key:"canvasDst",ref:V,width:"400",height:"300",title:"选中样本后，在这里点击把该点颜色设为目标色",onClick:We,class:"canvas"},null,512)]),_:1})]),_:1}),l(m,{"content-position":"left"},{default:a(()=>[l(r,{type:"primary"},{default:a(()=>[...e[23]||(e[23]=[p("2) 样本列表",-1)])]),_:1})]),_:1}),l(t,null,{default:a(()=>[l(i,{onClick:st,type:"warning",size:"small"},{default:a(()=>[...e[24]||(e[24]=[p("清空所有样本",-1)])]),_:1}),l(r,{size:"small",type:"secondary",class:"ml-3"},{default:a(()=>[...e[25]||(e[25]=[p(" 样本技巧：至少5个不同色调/亮度/饱和度的点，才能拟合非纯偏移矩阵 ",-1)])]),_:1})]),_:1}),l(r,{size:"small",type:"secondary",class:"mb-2 block"},{default:a(()=>[...e[26]||(e[26]=[p(" 左图点击加样本 | 单击行选中 | 右图点击设目标色 | 支持权重设置 ",-1)])]),_:1}),l(c,{height:"300px",class:"samples-scroll mb-3"},{default:a(()=>[(H(!0),j(de,null,me(A.value,(s,$)=>(H(),j("div",{key:s.id,class:Se(["sample-item",{selected:s.id===T.value}]),onClick:te=>T.value=s.id},[l(t,{gutter:8,align:"middle",class:"py-1"},{default:a(()=>[l(n,{span:5},{default:a(()=>[l(r,{size:"small",type:"secondary"},{default:a(()=>[p("#"+X($+1),1)]),_:2},1024),z("div",{class:"swatch",style:le({background:E(s.src[0],s.src[1],s.src[2])})},null,4),l(r,{size:"mini"},{default:a(()=>[p("原 RGB("+X(s.src[0])+","+X(s.src[1])+","+X(s.src[2])+")",1)]),_:2},1024)]),_:2},1024),l(n,{span:5},{default:a(()=>[z("div",{class:"swatch",style:le({background:E(s.dst[0],s.dst[1],s.dst[2])})},null,4),l(r,{size:"mini"},{default:a(()=>[p("现 RGB("+X(s.dst[0])+","+X(s.dst[1])+","+X(s.dst[2])+")",1)]),_:2},1024)]),_:2},1024),l(n,{span:7},{default:a(()=>[w(" <ColorPicker /> "),l($t,{modelValue:s.targetHex,"onUpdate:modelValue":te=>s.targetHex=te,"default-color":"#409eff"},null,8,["modelValue","onUpdate:modelValue"]),w(' <v3-color-picker v-model:value="sp.targetHex" btn></v3-color-picker> '),w(' <colorPicker v-model="sp.targetHex" /> '),w(' <el-color-picker v-model="sp.targetHex" size="small"></el-color-picker> '),l(d,{modelValue:s.weight,"onUpdate:modelValue":te=>s.weight=te,modelModifiers:{number:!0},size:"small",min:0,step:.1,class:"mt-1",style:{width:"70px"},placeholder:"权重"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(n,{span:5},{default:a(()=>[l(i,{size:"mini",type:"primary",onClick:()=>Ye(s),class:"mb-1"},{default:a(()=>[...e[27]||(e[27]=[p(" 偏移匹配 ",-1)])]),_:1},8,["onClick"]),l(i,{size:"mini",type:"danger",onClick:()=>Xe(s.id)},{default:a(()=>[...e[28]||(e[28]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)],10,Rt))),128))]),_:1}),l(h,{shadow:"inner","body-style":"background: #f5f7fa;",class:"mb-3"},{header:a(()=>[l(r,{type:"primary",size:"small"},{default:a(()=>[...e[29]||(e[29]=[p("快捷偏移匹配",-1)])]),_:1})]),default:a(()=>[l(t,{gutter:10,align:"middle"},{default:a(()=>[l(f,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=s=>C.value=s),size:"small"},null,8,["modelValue"]),l(i,{onClick:Qe,type:"primary",size:"small"},{default:a(()=>[...e[30]||(e[30]=[p(" 执行偏移匹配 ",-1)])]),_:1})]),_:1})]),_:1}),l(h,{shadow:"inner","body-style":"background: #f5f7fa;"},{default:a(()=>[l(r,{size:"small"},{default:a(()=>[...e[31]||(e[31]=[p("诊断：",-1)])]),_:1}),l(r,{size:"small",innerHTML:O.value,class:"block mt-1"},null,8,["innerHTML"])]),_:1})]),_:1})]),_:1}),w(" 右侧面板：所有设置项 "),l(n,{span:17},{default:a(()=>[l(t,{gutter:0},{default:a(()=>[w(" 第一行：拟合矩阵设置 "),l(n,{span:24},{default:a(()=>[l(h,{class:"card",shadow:"hover"},{header:a(()=>[l(r,{type:"primary"},{default:a(()=>[...e[32]||(e[32]=[p("3) 矩阵拟合设置",-1)])]),_:1})]),default:a(()=>[l(t,{gutter:15,align:"middle",class:"mb-3"},{default:a(()=>[l(n,{span:6},{default:a(()=>[l(i,{onClick:Je,type:"success",size:"small",class:"w-100"},{default:a(()=>[...e[33]||(e[33]=[p(" 拟合矩阵（加权最小二乘） ",-1)])]),_:1})]),_:1}),l(n,{span:6},{default:a(()=>[l(k,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=s=>v.value=s),size:"small"},{default:a(()=>[...e[34]||(e[34]=[p(" 锁定 Alpha 行（A' = A） ",-1)])]),_:1},8,["modelValue"])]),_:1}),l(n,{span:6},{default:a(()=>[l(I,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=s=>_.value=s),size:"small","active-text":"仅偏移","inactive-text":"全参数",disabled:o.isLoading},null,8,["modelValue","disabled"]),w(` <el-radio-group v-model="fitMode" size="small">
                                    <el-radio label="full" size="small">全参数</el-radio>
                                    <el-radio label="offset" size="small">仅偏移</el-radio>
                                </el-radio-group> `)]),_:1}),l(n,{span:6},{default:a(()=>[l(G,{label:"岭系数 λ",size:"small","label-width":"60px"},{default:a(()=>[l(d,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=s=>y.value=s),modelModifiers:{number:!0},size:"small",step:1e-4,min:0,placeholder:"0.001",style:{width:"100px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),w(" 第二行：快速调整滑杆（核心优化：两行3列布局） "),l(n,{span:24},{default:a(()=>[l(h,{class:"card",shadow:"hover"},{header:a(()=>[l(r,{type:"primary"},{default:a(()=>[...e[35]||(e[35]=[p("4) 快速调整（滑杆生成矩阵）",-1)])]),_:1})]),default:a(()=>[l(t,{gutter:0,class:"mb-4"},{default:a(()=>[l(n,{span:8},{default:a(()=>[w(" 每个滑杆占8列，24/3=8 "),l(G,{label:"亮度",size:"default"},{default:a(()=>[l(L,{modelValue:x.brightness,"onUpdate:modelValue":e[6]||(e[6]=s=>x.brightness=s),modelModifiers:{number:!0},min:-255,max:255,class:"slider-full-width"},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:8},{default:a(()=>[l(G,{label:"对比度",size:"default"},{default:a(()=>[l(L,{modelValue:x.contrast,"onUpdate:modelValue":e[7]||(e[7]=s=>x.contrast=s),modelModifiers:{number:!0},min:-100,max:100,class:"slider-full-width"},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:8},{default:a(()=>[l(G,{label:"饱和度",size:"default"},{default:a(()=>[l(L,{modelValue:x.saturation,"onUpdate:modelValue":e[8]||(e[8]=s=>x.saturation=s),modelModifiers:{number:!0},min:-100,max:100,class:"slider-full-width"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(t,{gutter:20,class:"mb-3"},{default:a(()=>[l(n,{span:8},{default:a(()=>[l(G,{label:"色相旋转",size:"default"},{default:a(()=>[l(L,{modelValue:x.hue,"onUpdate:modelValue":e[9]||(e[9]=s=>x.hue=s),modelModifiers:{number:!0},min:-180,max:180,postfix:"°",class:"slider-full-width"},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:8},{default:a(()=>[l(G,{label:"反色强度",size:"default"},{default:a(()=>[l(L,{modelValue:x.invert,"onUpdate:modelValue":e[10]||(e[10]=s=>x.invert=s),modelModifiers:{number:!0},min:0,max:1,step:.01,class:"slider-full-width"},null,8,["modelValue"])]),_:1})]),_:1}),l(n,{span:8},{default:a(()=>[l(G,{label:"整体透明度",size:"default"},{default:a(()=>[l(L,{modelValue:x.alpha,"onUpdate:modelValue":e[11]||(e[11]=s=>x.alpha=s),modelModifiers:{number:!0},min:0,max:1,step:.01,class:"slider-full-width"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(t,{class:"slider-actions"},{default:a(()=>[l(i,{onClick:Ke,type:"primary",size:"small"},{default:a(()=>[...e[36]||(e[36]=[p(" 根据滑杆生成矩阵 ",-1)])]),_:1}),l(r,{size:"small",type:"secondary",class:"ml-3"},{default:a(()=>[...e[37]||(e[37]=[p(" 按“始终基于原图”决定替换或叠加矩阵 ",-1)])]),_:1}),w(" 原图/预览画布 "),l(k,{modelValue:Z.value,"onUpdate:modelValue":e[12]||(e[12]=s=>Z.value=s),size:"small"},{default:a(()=>[...e[38]||(e[38]=[p(" 始终基于原图（替换矩阵） ",-1)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),w(" 第三行：颜色矩阵编辑 "),l(n,{span:24},{default:a(()=>[l(h,{class:"card",shadow:"hover"},{header:a(()=>[l(r,{type:"primary"},{default:a(()=>[...e[39]||(e[39]=[p("5) 颜色矩阵（4×5）编辑",-1)])]),_:1})]),default:a(()=>[l(ge,{data:ne.value,border:"",size:"small",class:"matrix-table mb-3","show-header":!0},{default:a(()=>[l(N,{label:"",width:"50"},{default:a(s=>[l(r,{type:"secondary"},{default:a(()=>[p(X(s.row.label),1)]),_:2},1024)]),_:1}),l(N,{label:"R",width:"90"},{default:a(s=>[l(D,{modelValue:s.row.r,"onUpdate:modelValue":$=>s.row.r=$,size:"mini",onChange:$=>ie(s.row.index,0,s.row.r),title:`m[${s.row.index},0] (${s.row.label}) ← R`},null,8,["modelValue","onUpdate:modelValue","onChange","title"])]),_:1}),l(N,{label:"G",width:"90"},{default:a(s=>[l(D,{modelValue:s.row.g,"onUpdate:modelValue":$=>s.row.g=$,size:"mini",onChange:$=>ie(s.row.index,1,s.row.g),title:`m[${s.row.index},1] (${s.row.label}) ← G`},null,8,["modelValue","onUpdate:modelValue","onChange","title"])]),_:1}),l(N,{label:"B",width:"90"},{default:a(s=>[l(D,{modelValue:s.row.b,"onUpdate:modelValue":$=>s.row.b=$,size:"mini",onChange:$=>ie(s.row.index,2,s.row.b),title:`m[${s.row.index},2] (${s.row.label}) ← B`},null,8,["modelValue","onUpdate:modelValue","onChange","title"])]),_:1}),l(N,{label:"A",width:"90"},{default:a(s=>[l(D,{modelValue:s.row.a,"onUpdate:modelValue":$=>s.row.a=$,size:"mini",onChange:$=>ie(s.row.index,3,s.row.a),title:`m[${s.row.index},3] (${s.row.label}) ← A`},null,8,["modelValue","onUpdate:modelValue","onChange","title"])]),_:1}),l(N,{label:"偏移",width:"90"},{default:a(s=>[l(D,{modelValue:s.row.offset,"onUpdate:modelValue":$=>s.row.offset=$,size:"mini",onChange:$=>ie(s.row.index,4,s.row.offset),title:`m[${s.row.index},4] (${s.row.label}) ← 偏移`},null,8,["modelValue","onUpdate:modelValue","onChange","title"])]),_:1})]),_:1},8,["data"]),l(t,{gutter:10,class:"mb-3"},{default:a(()=>[l(i,{onClick:et,size:"small"},{default:a(()=>[...e[40]||(e[40]=[p("设为单位矩阵",-1)])]),_:1}),l(i,{onClick:tt,size:"small",type:"primary"},{default:a(()=>[...e[41]||(e[41]=[p("应用输入值",-1)])]),_:1}),w(' <el-button @click="copyAsCSV" size="small" type="success">复制为CSV</el-button> '),w(` <el-button @click="copyAsAS3" size="small" type="info">复制为AS3代码</el-button>
                            <el-button @click="downloadResult" size="small" type="warning">下载效果PNG</el-button> `)]),_:1}),l(r,{size:"small",type:"secondary",class:"block mb-3"},{default:a(()=>[...e[42]||(e[42]=[p(" 行：R' / G' / B' / A'；列：R / G / B / A / Offset（单位 0~255） ",-1)])]),_:1})]),_:1})]),_:1}),w(" 第四行：导入导出 "),Ae(B).query.id?w("v-if",!0):(H(),ue(n,{key:0,span:24},{default:a(()=>[l(h,{class:"card",shadow:"hover"},{header:a(()=>[l(r,{type:"primary"},{default:a(()=>[...e[43]||(e[43]=[p("6) 矩阵导入 / 导出",-1)])]),_:1})]),default:a(()=>[l(D,{modelValue:q.value,"onUpdate:modelValue":e[13]||(e[13]=s=>q.value=s),type:"textarea",rows:4,placeholder:"在此粘贴或查看矩阵（逗号 / 空格 / 换行皆可）。会解析前 20 个数字。",class:"mb-3"},null,8,["modelValue"]),l(t,{gutter:10},{default:a(()=>[l(i,{onClick:lt,size:"small",type:"primary"},{default:a(()=>[...e[44]||(e[44]=[p("导出到文本区",-1)])]),_:1}),l(i,{onClick:at,size:"small",type:"success"},{default:a(()=>[...e[45]||(e[45]=[p("从文本区加载",-1)])]),_:1}),l(i,{onClick:ot,size:"small",type:"danger"},{default:a(()=>[...e[46]||(e[46]=[p("清空文本区",-1)])]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1})}}}),ba=Ne(Bt,[["__scopeId","data-v-e907672f"],["__file","/home/runner/work/seer-micro/seer-micro/frontend/src/modules/editor/views/color.vue"]]);export{ba as default};
