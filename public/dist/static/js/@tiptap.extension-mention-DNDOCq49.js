import{N as m,m as l}from"./@tiptap.core-HsqG-hEX.js";import{N as f}from"./prosemirror-model-CRZLy2j9.js";import{S as T}from"./@tiptap.suggestion-D1eFLxRa.js";import{a as b}from"./prosemirror-state-DcLGimL2.js";function v({editor:e,overrideSuggestionOptions:t,extensionName:n,char:r="@"}){const i=new b;return{editor:e,char:r,pluginKey:i,command:({editor:o,range:d,props:u})=>{var s,a,c;const p=o.view.state.selection.$to.nodeAfter;((s=p==null?void 0:p.text)===null||s===void 0?void 0:s.startsWith(" "))&&(d.to+=1),o.chain().focus().insertContentAt(d,[{type:n,attrs:{...u,mentionSuggestionChar:r}},{type:"text",text:" "}]).run(),(c=(a=o.view.dom.ownerDocument.defaultView)===null||a===void 0?void 0:a.getSelection())===null||c===void 0||c.collapseToEnd()},allow:({state:o,range:d})=>{const u=o.doc.resolve(d.from),s=o.schema.nodes[n];return!!u.parent.type.contentMatch.matchType(s)},...t}}function h(e){return(e.options.suggestions.length?e.options.suggestions:[e.options.suggestion]).map(t=>v({editor:e.editor,overrideSuggestionOptions:t,extensionName:e.name,char:t.char}))}function g(e,t){const n=h(e),r=n.find(i=>i.char===t);return r||(n.length?n[0]:null)}const w=m.create({name:"mention",priority:101,addOptions(){return{HTMLAttributes:{},renderText({node:e,suggestion:t}){var n,r;return`${(n=t==null?void 0:t.char)!==null&&n!==void 0?n:"@"}${(r=e.attrs.label)!==null&&r!==void 0?r:e.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:e,node:t,suggestion:n}){var r,i;return["span",l(this.HTMLAttributes,e.HTMLAttributes),`${(r=n==null?void 0:n.char)!==null&&r!==void 0?r:"@"}${(i=t.attrs.label)!==null&&i!==void 0?i:t.attrs.id}`]},suggestions:[],suggestion:{}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}},mentionSuggestionChar:{default:"@",parseHTML:e=>e.getAttribute("data-mention-suggestion-char"),renderHTML:e=>({"data-mention-suggestion-char":e.mentionSuggestionChar})}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:e,HTMLAttributes:t}){const n=g(this,e.attrs.mentionSuggestionChar);if(this.options.renderLabel!==void 0)return["span",l({"data-type":this.name},this.options.HTMLAttributes,t),this.options.renderLabel({options:this.options,node:e,suggestion:n})];const r={...this.options};r.HTMLAttributes=l({"data-type":this.name},this.options.HTMLAttributes,t);const i=this.options.renderHTML({options:r,node:e,suggestion:n});return typeof i=="string"?["span",l({"data-type":this.name},this.options.HTMLAttributes,t),i]:i},renderText({node:e}){const t={options:this.options,node:e,suggestion:g(this,e.attrs.mentionSuggestionChar)};return this.options.renderLabel!==void 0?this.options.renderLabel(t):this.options.renderText(t)},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:e,state:t})=>{let n=!1;const{selection:r}=t,{empty:i,anchor:o}=r;if(!i)return!1;t.doc.nodesBetween(o-1,o,(s,a)=>{if(s.type.name===this.name)return n=!0,e.insertText(this.options.deleteTriggerWithBackspace?"":this.options.suggestion.char||"",a,a+s.nodeSize),!1});let d=new f,u=0;return t.doc.nodesBetween(o-1,o,(s,a)=>{if(s.type.name===this.name)return n=!0,d=s,u=a,!1}),n&&e.insertText(this.options.deleteTriggerWithBackspace?"":d.attrs.mentionSuggestionChar,u,u+d.nodeSize),n})}},addProseMirrorPlugins(){return h(this).map(T)}});export{w as M};
